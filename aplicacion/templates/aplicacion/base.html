{% load static %}
<html>
    <head>
        <title>Finances</title>
        <script src='https://unpkg.com/popper.js/dist/umd/popper.min.js'></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.js"></script>
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
        <link href='//fonts.googleapis.com/css?family=Lobster&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="{% static 'aplicacion/base.css' %}">
        <link href="{% static 'aplicacion/fullcalendar/lib/main.css' %}" rel='stylesheet' />
        <link href="{% static 'aplicacion/fullcalendar/lib/main.min.css' %}" rel='stylesheet' />
        <script src="{% static 'aplicacion/fullcalendar/lib/main.js' %}"></script>
        <script src='https://unpkg.com/tooltip.js/dist/umd/tooltip.min.js'></script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script src="https://code.highcharts.com/modules/exporting.js"></script>
        <script src="https://code.highcharts.com/modules/export-data.js"></script>
        <script src="https://code.highcharts.com/modules/accessibility.js"></script>

        <script>
    
            document.addEventListener('DOMContentLoaded', function() {
              var calendarEl = document.getElementById('calendar');
              var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                themeSystem: 'bootstrap5',
                locale: 'es',
                expandRows: true,
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,listMonth'
                },
                selectable: true,
                dayMaxEvents: true,
                

                events: [
                    {% for gast in gastos_o %}
                        {
                            id: '{{ gast.id_usuario}}',
                            title: '{{ gast.titulo}}',
                            description: '{{gast.descripcion}} \nMonto: ${{gast.monto}}',
                            start: '{{ gast.fecha_cobro | date:"Y-m-d" }}',
                            setEnd: '{{ gast.fecha_cobro | date:"Y-m-d" }}',

    
                        },
                    {% endfor %}
                ],
                eventClick: function(info) {
    	            alert('Evento: ' + info.event.title + '\n' + 'Descripcion: ' + info.event.extendedProps.description);
                },
    
              });
              calendar.render();
            });
      
            
          </script>
    </head>
    <body>
        <div class="page-header">
            <h1><a href="/">Finances creative title</a></h1>
        </div>
        <div>
            <div id="container">
                <ul id="menu">
                  <li><a href="{% url 'gastos_new' %}">Nuevo gasto</a>
                  <li><a href="#">Nuevo ingreso</a>

                  </li>
                  <li><a href="{% url 'resumen' %}">Resumen</a>
                  </li>
                  <li><a href="#">Sobre el proyecto</a>
                    <ul>
                      <li><a href="#">Como usar</a></li>
                    </ul>
                  </li>
                  <li><a href="#">Support</a></li>
                </ul>
                </div>
                

        </div>
        


        <div class="content container">
            <div class="row">
                <div class="col-md-8">
                    {% block content %}
                    {% endblock %}
                </div>
            </div>
        </div>

        
        <script>
        Highcharts.chart('containerr', {
            chart: {
                type: 'column',
                backgroundColor:'#F8F9F9'
            },
            title: {
                text: 'Resumen Movimientos'
            },
            xAxis: {
                title: {
                    useHTML: true,
                    text: 'Mes'
                },
                categories: [
                    {% for mes in name_d_list %}'{{mes}}'{% if not forloop.last %}, {% endif %}{% endfor %}
                ]
            },
            yAxis: {
                title: {
                    useHTML: true,
                    text: 'Monto (clp)'
                }
            },
            credits: {
                enabled: false
            },
            series: [{
                name: 'Gastos',
                label: 'Gastos',
                data: [
                    {% for ctd in date_list %}{{ ctd }}{% if not forloop.last %}, {% endif %}{% endfor %}
                ],
                color: 'orange'
            }]
        });
        </script>
        
        
        <script>
            var nombres = [{% for cat in cat_list %}'{{cat}}'{% if not forloop.last %}, {% endif %}{% endfor %}];
            var valores2 = [{% for number in number_list %}'{{ number }}'{% if not forloop.last %}, {% endif %}{% endfor %}];
            var valores = [];
            for (let i=0; i<valores2.length; i++){
                valores.push(parseInt(valores2[i]));
            }
            dataa = [];
            for (let i=0; i<nombres.length; i++){
                dataa.push({name: nombres[i], y: valores[i]});
            }
            
            Highcharts.chart('pie', {
                chart: {
                    plotBackgroundColor: true,
                    backgroundColor:'#F8F9F9',
                    plotBorderWidth: null,
                    plotShadow: false,
                    type: 'pie'
                },
                title: {
                    text: 'Resumen Gastos por CategorÃ­a'
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },
                accessibility: {
                    point: {
                        valueSuffix: '%'
                    }
                },
                credits: {
                    enabled: false
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b>: {point.percentage:.1f} %'
                        }
                    }
                },
                series: [{
                    name: 'Porcentaje',
                    colorByPoint: true,
                    data: dataa
                }]
            });
            </script>





<script src="https://code.highcharts.com/highcharts.src.js"></script>
<script src="{% static 'aplicacion/resumen/table.js' %}"></script>
    </body>
</html>