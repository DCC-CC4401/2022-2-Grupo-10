{% extends 'aplicacion/base.html' %}

{% block content %}

<!-- TABLAS -->

<div class="parent">
	<div class="child0">
	<div id="main-container">
		<div id="titulo_tabla">
			<h1><u>Detalle Movimientos</u></h1>
		</div>
		<div>
			<label for="date-range">Mostrar: </label>
			<select id="data-range" onchange="selection();">
				<option value="1">Últimos 7 días</option>
				<option value="2" selected>Últimos 30 días</option>
				<option value="3">Últimos 60 días </option>
				<option value="4">Este año</option>
			</select>
			
		</div>

<table class="table-sortable" id="table_resumen1" style="display:none;">
	<thead>
		<tr>
			<th>Descripción</th><th>Categoría</th><th>Fecha</th><th>Costo</th>
		</tr>
	</thead>
	{% for gast in gastos1 %}
	<tr>
		<td>{{ gast.titulo }}</td><td>{{gast.categoria}}</td><td>{{ gast.fecha_cobro}}</td><td>{{gast.monto}}
		</td>
	</tr>
	{% endfor %}
</table>	

<table class="table-sortable" id="table_resumen2" style="display:none;">
	<thead>
		<tr>
			<th>Descripción</th><th>Categoría</th><th>Fecha</th><th>Costo</th>
		</tr>
	</thead>
	{% for gast in gastos2 %}
	<tr>
		<td>{{ gast.titulo }}</td><td>{{gast.categoria}}</td><td>{{ gast.fecha_cobro}}</td><td>{{gast.monto}}
		</td>
	</tr>
	{% endfor %}
</table>	

<table class="table-sortable" id="table_resumen3" style="display:none;">
	<thead>
		<tr>
			<th>Descripción</th><th>Categoría</th><th>Fecha</th><th>Costo</th>
		</tr>
	</thead>
	{% for gast in gastos3 %}
	<tr>
		<td>{{ gast.titulo }}</td><td>{{gast.categoria}}</td><td>{{ gast.fecha_cobro}}</td><td>{{gast.monto}}
		</td>
	</tr>
	{% endfor %}
</table>

<table class="table-sortable" id="resumen_anual" style="display:none;">
	<thead>
		<tr>
			<th>Descripción</th><th>Categoría</th><th>Fecha</th><th>Costo</th>
		</tr>
	</thead>
	{% for gast in gastoanual %}
	<tr>
		<td>{{ gast.titulo }}</td><td>{{gast.categoria}}</td><td>{{ gast.fecha_cobro}}</td><td>{{gast.monto}}
		</td>
	</tr>
	{% endfor %}
</table>	

<div class="center_table">
	<table class="table-sortable" id="table_resumen"> </table>
</div>

<script>
	document.getElementById('table_resumen').innerHTML = document.getElementById('table_resumen2').innerHTML;
</script>

</div>
	</div>
	<div class="parent2" float="right;">
	<br></br>
	<br></br>
	<div class="child1">
		<div id = "containerr"></div>
	</div>
	<div class="child2">
		<div id = "pie"></div>
	</div>
</div>

<script>graphs()</script>
</div>

<!-- GRÁFICOS -->

<script>
	var data1 = [{% for ctd in date_list %}{{ ctd }}{% if not forloop.last %}, {% endif %}{% endfor %}];
	var data2 = [{% for ctd2 in date_list_2 %}{{ ctd2 }}{% if not forloop.last %}, {% endif %}{% endfor %}];

Highcharts.chart('containerr', {
	chart: {
		type: 'column',
		backgroundColor:'#F8F9F9',
		
	},
	title: {
		text: 'Resumen Movimientos',
		style: {
			fontFamily: 'Lobster'
		}
	},
	xAxis: {
		title: {
			useHTML: true,
			text: 'Mes'
		},
		categories: [
			{% for mes in name_d_list %}'{{mes}}'{% if not forloop.last %}, {% endif %}{% endfor %}
		]
	},
	yAxis: {
		title: {
			useHTML: true,
			text: 'Monto (clp)'
		}
	},
	credits: {
		enabled: false
	},
	series: [{
		name: 'Gastos',
		label: 'Gastos',
		data: data1,
		color: '#FFA000'
	},
	{
		name: 'Ingresos',
		label: 'Ingresos',
		data: data2,
		color: '#7CB342'
	}]
});
</script>


<script>
	var nombres = [{% for cat in cat_list %}'{{cat}}'{% if not forloop.last %}, {% endif %}{% endfor %}];
	var valores2 = [{% for number in number_list %}'{{ number }}'{% if not forloop.last %}, {% endif %}{% endfor %}];
	var valores = [];
	for (let i=0; i<valores2.length; i++){
		valores.push(parseInt(valores2[i]));
	}
	dataa = [];
	for (let i=0; i<nombres.length; i++){
		dataa.push({name: nombres[i], y: valores[i]});
	}
	
	Highcharts.chart('pie', {
		chart: {
			plotBackgroundColor: true,
			backgroundColor:'#F8F9F9',
			plotBorderWidth: null,
			plotShadow: false,
			type: 'pie'
		},
		title: {
			text: 'Resumen Gastos por Categoría',
			style: {
				fontFamily: 'Lobster'
			}
		},
		// tooltip: {
		// 	pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
		// },
		accessibility: {
			point: {
				valueSuffix: '%'
			}
		},
		credits: {
			enabled: false
		},
		plotOptions: {
			pie: {
				allowPointSelect: true,
				cursor: 'pointer',
				dataLabels: {
					enabled: true,
					format: '<b>{point.name}</b>: {point.percentage:.1f} %'
				}
			}
		},
		series: [{
			name: 'Total',
			colorByPoint: true,
			data: dataa,
		}]
	});
	</script>
	
{% endblock %}
